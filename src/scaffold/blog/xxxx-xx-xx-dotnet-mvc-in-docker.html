<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="apple-touch-icon" sizes="180x180" href="../img/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="../img/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="../img/favicon-16x16.png">
        <link rel="manifest" href="../img/site.webmanifest">

        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-SQ6LRSEYQ9"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());

            gtag('config', 'G-SQ6LRSEYQ9');
        </script>

        <title>.NET MVC in Docker</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
        <link rel="stylesheet" href="../styles.css">
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
            $(document).ready(function(){
                $("#menu").click(function(){
                    if($('#menu-container').is(':visible')){ 
                        $("#menu-container").slideUp("slow", function() {
                            // Animation complete.
                        });
                    }
                    else {
                        $("#menu-container").slideDown("slow", function() {
                            // Animation complete.
                        });
                    } 
                });
              });
        </script>
    </head>
    <body>
        {{{ header.html }}}

        <nav class="d-none d-md-block">
            <div class="desktop">
                <div class="layout">
                    <li><a href="../index.html">hello</a></li>
                    <li><a href="../blog.html" class="selected">blog</a></li>
                    <li><a href="../otherme.html">other me</a></li>
                    <li><a href="../projects.html">projects</a></li>
                </div>
            </div>
        </nav>

        <nav class="d-md-none navbar">
            <div class="container">
                <div class="row mobile">
                    <div id="menu" class="menu"><span class="hamburger"></span>menu</div>
                    <ul id="menu-container" class="navbar-nav menu-container" style="display:none">
                        <li class="col"><a href="../index.html">hello</a></li>
                        <li class="col"><a href="../blog.html" class="selected">blog</a></li>
                        <li class="col"><a href="../otherme.html">other me</a></li>
                        <li class="col"><a href="../projects.html">projects</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <div class="clear-both"></div>

        <div class="container mt-4 mb-4 layout">
            <div class="row justify-content-center">
                <div class="col col-lg-6 blog">
                    <h2>.NET MVC in Docker</h2>
                    <b>(.NET and Docker Part 5)</b>
                    <div class="date">xxxx/xx/xx</div>
                    <div style="margin-bottom:40px;">
                        <div class="tags">Tags: <span class="tag">.NET</span> <span class="tag">MVC</span> <span class="tag">Docker</span> <span class="tag">C#</span></div>
                        <div style="clear: both;"></div>
                    </div>         
                    
                    <h3>Introduction</h3>

                    <p>
                        This blog post builds on the previous posts of this series by building and running a .NET MVC app in Docker. As with all the other posts in this series, the code used in the post can be found in a github repo <a href="https://github.com/twarsop/dotnet-mvc-in-docker" target="_blank">here</a>.
                    </p>

                    <h3>The MVC App</h3>

                    <p>
                        Following the theme of the apps in this series, the MVC app we'll use for this blog post represents rolling a die. It is a very simple MVC app that simulates rolling a die with one button calling a single controller action that returns a random number representing the die roll:
                    </p>

                    <p>
                        [image here]
                    </p>

                    <h3>The Dockerfile</h3>

                    <p>
                        The Dockerfile we need to build and run an MVC is very similar the Dockerfile we used before for building and running a .NET console app (<a href="2023-11-06-building-and-running-a-dotnet-console-app-in-docker.html" target="_href">here</a>):
                    </p>

                    <pre>
                        <code>
    FROM mcr.microsoft.com/dotnet/sdk:8.0 AS build-env
    WORKDIR /app
    COPY src/. ./
    RUN dotnet restore
    RUN dotnet publish -c Release -o out
    
    FROM mcr.microsoft.com/dotnet/aspnet:8.0
    WORKDIR /app
    COPY --from=build-env /app/out .
    ENTRYPOINT ["dotnet", "DieRollerMVC.dll"]
                        </code>
                    </pre>

                    <p>
                        (Note: we're now using .NET 8)
                    </p>

                    <p>
                        In fact the build stage of this Dockerfile is the same as the console app's Dockerfile. The run stage is almost the same, there is only one small difference - the base image being used. Before for the console app used the runtime base image: <span class="inline-code">mcr.microsoft.com/dotnet/runtime:7.0</span> now because we want to run an MVC app we need to use an <span class="inline-code">aspnet</span>-based base image: <span class="inline-code">mcr.microsoft.com/dotnet/aspnet:8.0</span>.
                    </p>

                    <h3>Building and Running</h3>

                    <p>
                        Building the Docker image is exactly the same as before:
                    </p>

                    <pre>
                        <code>
    docker build -t dieroller .
                        </code>
                    </pre>

                    <p>
                        Which gives us an image called <span class="inline-code">dieroller</span>.
                    </p>

                    <p>
                        The Docker command to run the container is slightly different:
                    </p>

                    <pre>
                        <code>
    docker run -p 8080:8080 dieroller
                        </code>
                    </pre>

                    <p>
                        The difference here is the <span class="inline-code">-p 8080:8080</span> option being used in the run command. This does port mapping from the hosts port to the container's port. Essentially, when the MVC app container is running in Docker it will have a port exposed as you would expect a normal MVC app to have. For example, if you build and run the MVC app via the normal <span class="inline-code">dotnet</span> commands you can go to something like <span class="inline-code">localhost:1234</span> and your MVC app. But when the app is running in a Docker conatiner this port only works within the container, it needs to be mapped to a port on the host so when you go to <span class="inline-code">localhost:&lt;host port&gt;</span> it gets mapped to <span class="inline-code">container:&lt;host port&gt;</span> and everything workds seemlessly.
                    </p>

                    <p>
                        In .NET 8 the default port that gets used for ASP apps in Docker is 8080. As seen in <a href="https://learn.microsoft.com/en-us/dotnet/core/whats-new/dotnet-8/containers">this</a> update. That's why we use this port number in <span class="inline-code">-p</span> option.
                    </p>

                    <p>
                        Executing this <span class="inline-code">docker run</span> command we get our running container and we can the see the correct port mapping in Docker Desktop:
                    </p>

                    <p>
                        [Docker desktop image here of the container and port mapping]
                    </p>

                    <p>
                        And if we go to the local port we can see the MVC app working:
                    </p>

                    <p>
                        [Image of app running in Docker]
                    </p>

                    <h3>The End</h3>

                </div>
            </div>
        </div>

        {{{ footer_blog.html }}}
    </body>
</html>